<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title type="text">Tag: zend-framework :: phly, boy, phly</title>
  <updated>2014-08-26T20:15:00+0000</updated>
  <generator uri="http://framework.zend.com" version="2">Zend_Feed_Writer</generator>
  <link rel="alternate" type="text/html" href="http://mwop.net/blog/tag/zend-framework.html"/>
  <link rel="self" type="application/atom+xml" href="http://mwop.net/blog/tag/zend-framework-atom.xml"/>
  <id>http://mwop.net/blog/tag/zend-framework.html</id>
  <entry xmlns:xhtml="http://www.w3.org/1999/xhtml">
    <title type="html"><![CDATA[Deployment with Zend Server (Part 1 of 8)]]></title>
    <published>2014-08-26T20:15:00+0000</published>
    <updated>2014-08-26T20:15:00+0000</updated>
    <link rel="alternate" type="text/html" href="http://mwop.net/blog/2014-08-11-zend-server-deployment-part-1.html"/>
    <id>http://mwop.net/blog/2014-08-11-zend-server-deployment-part-1.html</id>
    <author>
      <name>Matthew Weier O'Phinney</name>
      <email>me@mwop.net</email>
      <uri>http://mwop.net</uri>
    </author>
    <content xmlns:xhtml="http://www.w3.org/1999/xhtml" type="xhtml">
      <xhtml:div xmlns:xhtml="http://www.w3.org/1999/xhtml"><xhtml:p>I manage a number of websites running on Zend Server, Zend's PHP
application platform. I've started accumulating a number of
patterns and tricks that make the deployments more successful, and
which also allow me to do more advanced things such as setting up
recurring jobs for the application, clearing page caches, and
more.</xhtml:p>
<xhtml:h2>Yes, YOU can afford Zend Server</xhtml:h2>
<xhtml:p>"But, wait, Zend Server is uber-expensive!" I hear some folks
saying.</xhtml:p>
<xhtml:p>Well, yes and no.</xhtml:p>
<xhtml:p>With the release of Zend Server 7, Zend now offers a
"Development Edition" that contains all the features I've covered
here, and which runs $195. This makes it affordable for small shops
and freelancers, but potentially out of the reach of
individuals.</xhtml:p>
<xhtml:p>But there's another option, which I'm using, which is even more
intriguing: <xhtml:a href="http://www.zend.com/en/solutions/cloud-solutions/aws-marketplace">Zend
Server on the Amazon Web Services (AWS) Marketplace</xhtml:a>. On AWS,
you can try out Zend Server free for 30 days. After that, you get
charged a fee on top of your normal AWS EC2 usage. Depending on the
EC2 instance you choose, this can run as low as ~$24/month (this is
on the t1.micro, and that's the total per month for both AWS and
Zend Server usage). That's cheaper than most VPS hosting or PaaS
providers, and gives you a full license for Zend Server.</xhtml:p>
<xhtml:p>Considering Zend Server is available on almost every PaaS and
IaaS offering available, this is a great way to try it out, as well
as to setup staging and testing servers cheaply; you can then
choose the provider you want based on its other features. For those
of you running low traffic or small, personal or hobbyist sites,
it's an inexpensive alternative to VPS hosting.</xhtml:p>
<xhtml:p>So... onwards with my first tip.</xhtml:p>
<xhtml:h2>Tip 1: zf-deploy</xhtml:h2>
<xhtml:p>My first trick is to use <xhtml:a href="https://github.com/zfcampus/zf-deploy">zf-deploy</xhtml:a>. This is a
tool <xhtml:a href="https://twitter.com/ezimuel">Enrico</xhtml:a> and I wrote
when prepping <xhtml:a href="https://apigility.org">Apigility</xhtml:a> for its
initial stable release. It allows you to create deployment packages
from your application, including zip, tarball, and ZPKs (Zend
Server deployment packages). We designed it to simplify packaging
<xhtml:a href="http://framework.zend.com">Zend Framework 2</xhtml:a> and
Apigility applications, but with a small amount of work, it could
likely be used for a greater variety of PHP applications.</xhtml:p>
<xhtml:p>zf-deploy takes the current state of your working directory, and
clones it to a working path. It then runs Composer (though you can
disable this), and strips out anything configured in your
<xhtml:kbd>.gitignore</xhtml:kbd> file (again, you can disable this). From
there, it creates your package.</xhtml:p>
<xhtml:p>One optional piece is that, when creating a ZPK, you can tell it
which <xhtml:kbd>deployment.xml</xhtml:kbd> you want to use and/or specify a
directory containing the <xhtml:kbd>deployment.xml</xhtml:kbd> and any install
scripts you want to include in the package. This latter is
incredibly useful, as you can use this to shape your
deployment.</xhtml:p>
<xhtml:p>As an example, on my own website, I have a CLI job that will
fetch my latest <xhtml:a href="https://github.com">GitHub</xhtml:a> activity. I
can invoke that in my <xhtml:kbd>post_stage.php</xhtml:kbd> script:</xhtml:p>
<xhtml:div class="example">
<xhtml:pre>
<xhtml:code language="php">
if (! chdir(getenv('ZS_APPLICATION_BASE_DIR'))) {
  throw new Exception('Unable to change to application directory');
}

$php = '/usr/local/zend/bin/php';

$command = $php . ' public/index.php githubfeed fetch';
echo "\nExecuting `$command`\n";
system($command);
</xhtml:code>
</xhtml:pre></xhtml:div>
<xhtml:p>One task I always do is make sure my application data directory
is writable by the web server. This next line builds on the above,
in that it assumes you've changed to your application directory
first:</xhtml:p>
<xhtml:div class="example">
<xhtml:pre>
<xhtml:code language="php">
$command = 'chmod -R a+rwX ./data';
echo "\nExecuting `$command`\n";
system($command);
</xhtml:code>
</xhtml:pre></xhtml:div>
<xhtml:p>Yes, PHP has a built-in for <xhtml:kbd>chmod</xhtml:kbd>, but it doesn't act
recursively.</xhtml:p>
<xhtml:p>For ZF2 and Apigility applications, zf-deploy also allows you to
specify a directory that contains the <xhtml:kbd>*local.php</xhtml:kbd> config
scripts for your <xhtml:kbd>config/autoload/</xhtml:kbd> directory, allowing
you to merge in configuration specific for the deployment
environment. This is a fantastic capability, as I can keep any
private configuration separate from my main repository.</xhtml:p>
<xhtml:p>Deployment now becomes:</xhtml:p>
<xhtml:div class="example">
<xhtml:pre>
<xhtml:code language="bash">
$ vendor/bin/zfdeploy.php mwop.net.zpk --configs=../mwop.net-config --zpk=zpk
</xhtml:code>
</xhtml:pre></xhtml:div>
<xhtml:p>and I now have a ZPK ready to push to Zend Server.</xhtml:p>
<xhtml:p>In sum: zf-deploy simplifies ZPK creation, and allows you to add
deployment scripts that let you perform other tasks on the
server.</xhtml:p>
<xhtml:h2>Next time...</xhtml:h2>
<xhtml:p>I've got a total of 8 tips queued up, including this one, and
will be publishing on Tuesdays and Thursdays; I'll update each post
to link to the others in the series. Next tip: creating scheduled
Job Queue jobs, Ã  la cronjobs.</xhtml:p>
</xhtml:div>
    </content>
  </entry>
</feed>
